const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModeStepView-_o4Z1WbA.js","assets/index-DPNhxiUx.js","assets/index-BLQmJMS8.css","assets/builderStore-eK4imx-H.js","assets/constants--7Vy3u4O.js","assets/calculators-SnRFNRCc.js","assets/createCharacter-Bh61okBK.js","assets/PDFButton-DossJXaQ.js","assets/checkbox-gXCwxbfc.js","assets/dice-6-khfjXeaw.js","assets/SpecieStepView-Bf_o74fz.js","assets/EntitySelectionStepView-CURc7_Wt.js","assets/EntityList-tKXsxAB4.js","assets/testId-C2BDkHTB.js","assets/StarStepView-CyioZO6N.js","assets/CareerStepView-mfUH0QrK.js","assets/CharacteristicsStepView-BWZdiyth.js","assets/BudgetDisplay-DAIywZrz.js","assets/AdjusterControls-D1aRQsyj.js","assets/SkillsStepView-Djkr7Fmt.js","assets/TalentsStepView-CKTULzcy.js","assets/ChoiceButtons-Bd6FIGe-.js","assets/TrappingsStepView-BxYjmTt0.js","assets/coins-BbqHfTwk.js","assets/ExperienceStepView-C6QzpfMj.js","assets/TalentsBuyer-B-NWxpSZ.js","assets/DetailsStepView-DgXF9Qn5.js","assets/SummaryStepView-BM6nFIeT.js","assets/characterStore-C1iYDIap.js","assets/tabs-CeVincgM.js","assets/spellUtils-DntvT4X5.js","assets/SpellsSection-BhpK3thR.js","assets/circle-alert-BfJyMDa0.js","assets/GodStepView-uzoItezl.js","assets/MagicTraditionStepView-DCqj0p9y.js","assets/SpellsStepView-B7vyDv7d.js"])))=>i.map(i=>d[i]);
import{h as z,r as h,j as e,B as C,_ as b,i as E,k as T,l as J,m as Y,I as Z,n as L,o as R,p as O,q as V,s as P,C as ee,a as se,b as te,d as ne,D as M,t as B,v as $,w as G,x as U,u as re,f as v,y as ae,z as ie,A as le,E as ce}from"./index-DPNhxiUx.js";import{a as F,g as A,S as oe,A as de,u as _}from"./builderStore-eK4imx-H.js";import"./PDFButton-DossJXaQ.js";const ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],I=z("circle-question-mark",ue);const me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xe=z("circle",me),w=h.createContext(null);function we(n){const a=h.useContext(w);if(a)for(const s of n)a.consumed.add(s)}function he(n){const a=h.useContext(w);return a?n.filter(s=>!a.consumed.has(s.id)):n}function pe({children:n}){const a={consumed:new Set};return e.jsx(w.Provider,{value:a,children:n})}function fe({actions:n}){const{execute:a}=F(),d=he(n).filter(l=>l.role==="button");return d.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(l=>e.jsxs(C,{"data-testid":`action-${l.id}`,onClick:()=>a(l.id),variant:l.xpBonus?"default":"outline",children:[l.label,l.xpBonus!==void 0&&l.xpBonus>0&&e.jsxs("span",{className:"ml-2 text-xs opacity-70",children:["+",l.xpBonus," XP"]})]},l.id))})}const ge={mode:h.lazy(()=>b(()=>import("./ModeStepView-_o4Z1WbA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),specie:h.lazy(()=>b(()=>import("./SpecieStepView-Bf_o74fz.js"),__vite__mapDeps([10,1,2,11,3,4,5,6,7,12,13,9]))),star:h.lazy(()=>b(()=>import("./StarStepView-CyioZO6N.js"),__vite__mapDeps([14,1,2,11,3,4,5,6,7,12,13,9]))),career:h.lazy(()=>b(()=>import("./CareerStepView-mfUH0QrK.js"),__vite__mapDeps([15,1,2,11,3,4,5,6,7,12,13,9]))),characteristics:h.lazy(()=>b(()=>import("./CharacteristicsStepView-BWZdiyth.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,9,13,17,18]))),skills:h.lazy(()=>b(()=>import("./SkillsStepView-Djkr7Fmt.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,13,17,18,9]))),talents:h.lazy(()=>b(()=>import("./TalentsStepView-CKTULzcy.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,21,13,9]))),trappings:h.lazy(()=>b(()=>import("./TrappingsStepView-BxYjmTt0.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,21,13,9,23]))),experience:h.lazy(()=>b(()=>import("./ExperienceStepView-C6QzpfMj.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,17,25,13,9]))),details:h.lazy(()=>b(()=>import("./DetailsStepView-DgXF9Qn5.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,9]))),summary:h.lazy(()=>b(()=>import("./SummaryStepView-BM6nFIeT.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,28,29,30,31,13,23,32]))),god:h.lazy(()=>b(()=>import("./GodStepView-uzoItezl.js"),__vite__mapDeps([33,1,2,11,3,4,5,6,7,12,13,9]))),magicTradition:h.lazy(()=>b(()=>import("./MagicTraditionStepView-DCqj0p9y.js"),__vite__mapDeps([34,1,2,11,3,4,5,6,7,12,13,9]))),spells:h.lazy(()=>b(()=>import("./SpellsStepView-B7vyDv7d.js"),__vite__mapDeps([35,1,2,11,3,4,5,6,7,12,13,9])))};function je(){return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."})]})})}function ve({step:n}){const a=ge[n.id];if(!a)throw new Error(`No renderer found for step "${n.id}"`);return e.jsxs("div",{className:"h-full flex flex-col","data-testid":`step-${n.id}`,children:[n.subphase&&e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsx("span",{className:"text-sm text-primary px-2 py-1 bg-primary/10 rounded",children:n.subphase})}),n.errors.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-destructive/10 border border-destructive rounded flex-shrink-0",children:n.errors.map((s,d)=>e.jsx("p",{className:"text-destructive",children:s},d))}),e.jsxs(pe,{children:[e.jsx("div",{className:"flex-1 min-h-0 overflow-auto",children:e.jsx(h.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(a,{step:n})})}),n.actions.length>0&&e.jsx("div",{className:"mt-6 flex-shrink-0",children:e.jsx(fe,{actions:n.actions})})]})]})}function be({steps:n,currentStepId:a,onStepClick:s}){const d=A(a);return e.jsx("nav",{className:"flex flex-col h-full",children:oe.map(l=>{const g=n.filter(u=>A(u.id)===l.id),j=l.id===d,p=g.every(u=>u.status==="completed");return e.jsxs("div",{className:"mb-1",children:[e.jsxs("div",{className:E("px-3 py-1.5 text-xs font-semibold uppercase tracking-wider",j?"text-primary":"text-muted-foreground/70"),children:[p&&e.jsx(T,{className:"inline h-3 w-3 mr-1"}),l.label]}),e.jsx("div",{className:"space-y-0.5",children:g.map(u=>{const c=u.id===a,f=u.status==="completed"&&s,i=u.status==="completed";return e.jsxs("button",{onClick:()=>f&&s(u.id),disabled:!f,className:E("w-full flex items-center gap-2 px-3 py-2 text-sm transition-all rounded-r-lg border-l-2",c&&"bg-primary/20 border-l-primary text-primary font-medium",i&&!c&&"border-l-primary/50 text-muted-foreground hover:bg-muted/50 hover:text-foreground",!i&&!c&&"border-l-transparent text-muted-foreground/60",f&&"cursor-pointer",!f&&!c&&"cursor-default"),children:[e.jsx("span",{className:E("flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-xs",c&&"bg-primary text-primary-foreground",i&&!c&&"bg-primary/30 text-primary",!i&&!c&&"bg-muted text-muted-foreground"),children:i?e.jsx(T,{className:"h-3 w-3"}):c?e.jsx(J,{className:"h-3 w-3"}):e.jsx(xe,{className:"h-3 w-3"})}),e.jsx("span",{className:"truncate",children:u.label})]},u.id)})})]},l.id)})})}const S="__CUSTOM__";function _e({availableSpecs:n,value:a,onChange:s,placeholder:d="Choisir...",className:l="",label:g,compact:j=!1}){const p=n.split(",").map(x=>x.trim()).filter(x=>x.length>0),u=a&&!p.includes(a),[c,f]=h.useState(u?S:a),[i,m]=h.useState(u?a:"");h.useEffect(()=>{const x=a&&!p.includes(a);f(x?S:a),m(x?a:"")},[a,p]);const o=x=>{f(x),x===S?(m(""),s("")):(m(""),s(x))},y=x=>{m(x),s(x)};return e.jsxs("div",{className:`flex flex-col gap-2 ${l}`,children:[g&&e.jsx(Y,{className:j?"text-xs":"text-sm",children:g}),c===S?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{type:"text",placeholder:"Saisir une spécialisation...",value:i,onChange:x=>y(x.target.value),className:j?"h-7 text-xs flex-1":"flex-1",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>o(""),className:"text-xs text-muted-foreground hover:text-foreground underline whitespace-nowrap",children:"Annuler"})]}):e.jsxs(L,{value:c,onValueChange:o,children:[e.jsx(R,{className:j?"h-7 text-xs":"",children:e.jsx(O,{placeholder:d})}),e.jsxs(V,{children:[p.map(x=>e.jsx(P,{value:x,children:x},x)),e.jsx(P,{value:S,className:"italic",children:"Autre (saisie manuelle)..."})]})]})]})}function Ne({entityType:n,markers:a,actions:s,getAvailableSpecs:d,pendingSpecs:l={},title:g}){const{execute:j}=F(),p=a.filter(c=>c.type==="spec"),u=(c,f)=>{c&&j(f.id,c)};return p.length===0?null:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:g??`Spécialisations (${p.length} restante${p.length>1?"s":""})`}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:p.map(c=>{const f=s.find(o=>o.id===de.resolve(n,"spec",c.id)),i=d(c.entity),m=l[c.id]??"";return e.jsxs(ee,{children:[e.jsx(se,{className:"pb-2",children:e.jsx(te,{className:"text-base",children:c.displayLabel})}),e.jsx(ne,{children:e.jsx(_e,{availableSpecs:i,value:m,onChange:o=>f&&u(o,f),placeholder:"Choisir une spécialisation...",compact:!0})})]},c.id)})})]})}function ye({step:n}){const a=n.data?.unresolvedMarkers??[],s=!!n.data?.skillDefinitions,d=!!n.data?.talentDefinitions,l=s?"skill":d?"talent":"skill",g=h.useMemo(()=>{const i=new Map;if(s){const m=n.data?.skillDefinitions??[];for(const o of m)i.set(o.label,o)}else if(d){const m=n.data?.talentDefinitions??[];for(const o of m)i.set(o.label,o)}return i},[n.data?.skillDefinitions,n.data?.talentDefinitions,s,d]),j=h.useCallback(i=>{if(i.specs&&i.specs.length>0)return i.specs.join(", ");const m=g.get(i.id);return m?m.specs??"":""},[g]),p=n.data?.pendingSpecs??{},c=a.filter(i=>i.type==="spec").length>0;if(!c)return null;const f=l==="skill"?"Choisir une spécialisation de compétence":"Choisir une spécialisation de talent";return e.jsx(M,{open:c,children:e.jsxs(B,{className:"sm:max-w-md",onPointerDownOutside:i=>i.preventDefault(),onEscapeKeyDown:i=>i.preventDefault(),children:[e.jsxs($,{children:[e.jsx(G,{children:f}),e.jsx(U,{className:"sr-only",children:"Sélectionnez une spécialisation pour continuer"})]}),e.jsx(Ne,{entityType:l,markers:a,actions:n.actions,getAvailableSpecs:j,pendingSpecs:p})]})})}function Ce({text:n,className:a}){const s=n.split(`
`),d=[];let l=[],g=[];const j=()=>{l.length>0&&(d.push(e.jsx("p",{className:"text-muted-foreground leading-7",children:l},d.length)),l=[])},p=()=>{g.length>0&&(d.push(e.jsx("ul",{className:"space-y-3 text-muted-foreground ml-1",children:g},d.length)),g=[])},u=i=>i.split(/(\*\*[^*]+\*\*)/g).map((o,y)=>o.startsWith("**")&&o.endsWith("**")?e.jsx("strong",{className:"text-foreground font-medium",children:o.slice(2,-2)},y):o),c=i=>/^\*\*[^*]+\*\*\s*:?\s*$/.test(i),f=i=>{const m=i.match(/^\*\*([^*]+)\*\*/);return m?m[1].replace(/:$/,""):i};return s.forEach((i,m)=>{const o=i.trim();o===""?(p(),j()):c(o)?(p(),j(),d.push(e.jsx("h4",{className:"font-semibold text-foreground text-base mt-5 first:mt-0 mb-2 border-b border-border/30 pb-1",children:f(o)},d.length))):o.startsWith("- ")?(j(),g.push(e.jsx("li",{className:"pl-5 relative before:content-['•'] before:absolute before:left-0 before:text-primary leading-6",children:u(o.slice(2))},m))):(p(),l.length>0&&l.push(" "),l.push(u(o)))}),p(),j(),e.jsx("div",{className:E("text-sm space-y-4",a),children:d})}function Se(){const n=re(),a=_(t=>t.builder),s=_(t=>t.currentStep),d=_(t=>t.steps),l=_(t=>t.goToStep),g=_(t=>t.lockCurrentStep),j=_(t=>t.clear),p=_(t=>t.save),u=_(t=>t.commitPending),c=_(t=>t.discardPending),f=_(t=>t.nextSubphase),i=_(t=>t.previousSubphase),m=_(t=>t.completeConditionalStep),o=v(t=>t.datasets),y=v(t=>t.activeDatasetId),x=v(t=>t.setActiveDataset);if(!a||!s)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:"Aucun personnage en cours de création"}),e.jsx("button",{onClick:()=>n("/characters/new"),className:"text-primary hover:underline",children:"Créer un nouveau personnage"})]})});const N=s.navigation,k=a.isOnConditionalStep(),r=N.canPrev,D=N.canNext,W=N.hasPending,X=()=>{if(!r)return;const t=s.id;N.hasPending&&c(t),i()},H=()=>{if(!D)return;const t=s.id;if(N.hasPending&&u(t),k){m();return}N.hasMoreSubphases||g(),f()},q=()=>{const t=s.id;c(t)},Q=()=>{p(),j(),n("/characters")},K=t=>{l(t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsxs("aside",{className:"w-56 flex-shrink-0 bg-muted flex flex-col",children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-sm font-semibold text-primary uppercase tracking-wide",children:"Création"}),e.jsxs(ae,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-sm cursor-help",children:[e.jsx(I,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"XP:"}),e.jsx("span",{className:"font-bold text-primary text-lg",children:a.getTotalXp()})]})}),e.jsxs(le,{side:"right",className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Points d'Expérience (XP)"}),e.jsx("p",{className:"text-xs",children:"Points gagnés lors de la création. Les choix aléatoires donnent plus d'XP. Utilisez-les pour améliorer votre personnage."})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto py-2 scrollbar-warhammer",children:e.jsx(be,{steps:d,currentStepId:s.id,onStepClick:K})}),e.jsxs("div",{className:"p-3 space-y-2 border-t border-border/50",children:[e.jsxs(L,{value:y??"official",onValueChange:t=>x(t==="official"?null:t),children:[e.jsx(R,{className:"w-full h-8 text-xs",children:e.jsx(O,{placeholder:"Source"})}),e.jsxs(V,{children:[e.jsx(P,{value:"official",children:"Officiel"}),o.map(t=>e.jsx(P,{value:t.metadata.id,children:t.metadata.name},t.metadata.id))]})]}),e.jsx(C,{"data-testid":"nav-cancel",variant:"outline",onClick:Q,size:"sm",className:"w-full text-muted-foreground hover:text-destructive hover:border-destructive",children:"Quitter la création"})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("header",{className:"flex-shrink-0 px-6 py-3 bg-muted",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:s.label}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),s.data&&"instructions"in s.data&&typeof s.data.instructions=="string"&&e.jsxs(M,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(C,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",children:[e.jsx(I,{className:"h-4 w-4 mr-1.5"}),"Aide"]})}),e.jsxs(B,{className:"max-w-md",children:[e.jsxs($,{children:[e.jsxs(G,{children:["Instructions — ",s.label]}),e.jsxs(U,{className:"sr-only",children:["Instructions pour l'étape ",s.label]})]}),e.jsx(Ce,{text:s.data.instructions})]})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:e.jsx(ve,{step:s})}),e.jsxs("footer",{className:"flex-shrink-0 px-4 py-3 flex justify-between items-center bg-muted border-t border-border/50",children:[e.jsx("div",{className:"w-28",children:W&&e.jsx(C,{"data-testid":"nav-reset",variant:"outline",onClick:q,size:"sm",className:"text-muted-foreground",children:"Réinitialiser"})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(C,{"data-testid":"nav-previous",variant:"outline",onClick:X,size:"sm",disabled:!r,children:["← ",N.prevLabel||"Précédent"]}),e.jsxs(C,{"data-testid":"nav-next",onClick:H,size:"sm",className:"px-6",disabled:!D,children:[N.nextLabel||"Suivant"," →"]})]}),e.jsx("div",{className:"w-28"})]})]})]}),e.jsx(ye,{step:s})]})}function ke(){const n=_(r=>r.builder),a=_(r=>r.create),s=v(r=>r.specie),d=v(r=>r.star),l=v(r=>r.career),g=v(r=>r.careerLevel),j=v(r=>r.class),p=v(r=>r.characteristic),u=v(r=>r.skill),c=v(r=>r.talent),f=v(r=>r.spell),i=v(r=>r.trapping),m=v(r=>r.god),o=v(r=>r.magick),y=v(r=>r.eye),x=v(r=>r.hair),N=v(r=>r.detail),k=v(r=>r.names);return h.useEffect(()=>{if(!n&&s.length>0){const r={specie:s,star:d,career:l,careerLevel:g,class:j,characteristic:p,skill:u,talent:c,spell:f,trapping:i,god:m,magick:o,eye:y,hair:x,detail:N,names:k},D=window.__TEST_SEED__;a(r,void 0,D)}},[n,s,d,l,g,j,p,u,c,f,i,m,o,y,x,N,k,a]),s.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-muted-foreground",children:"Chargement des données..."})}):e.jsx(Se,{})}const Te=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"}));export{Te as C,Ce as F,we as u};
