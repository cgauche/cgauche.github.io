import{r as d,j as e,B as N,V,l as D,W as I,f as p,X as T,Y as A,Z as B,$ as P,n as O,o as z,p as R,q as G,s as C,a0 as L}from"./index-BE7IJKJC.js";import{P as H,E as $}from"./EntityList-BWFM1TNT.js";import"./testId-C2BDkHTB.js";const S=[{id:"personnage",label:"Personnage"},{id:"competences",label:"Compétences"},{id:"equipement",label:"Équipement"},{id:"effets",label:"Effets"},{id:"magie",label:"Magie"},{id:"monde",label:"Monde"}];function K({filters:a,values:i,onChange:l,options:u}){const[n,t]=d.useState(!1);return a.length===0?null:e.jsxs("div",{children:[e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>t(!n),className:"text-sm",children:[n?e.jsx(V,{className:"h-4 w-4 mr-1"}):e.jsx(D,{className:"h-4 w-4 mr-1"}),"Filtres avancés"]}),n&&e.jsx("div",{className:"mt-2 space-y-2 pl-4",children:a.map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground w-24",children:[r.label,":"]}),r.type==="boolean"?e.jsx("input",{type:"checkbox",checked:!!i[r.key],onChange:m=>l(r.key,m.target.checked)}):e.jsxs("select",{value:String(i[r.key]??"__all__"),onChange:m=>l(r.key,m.target.value),className:"text-sm border rounded px-2 py-1",children:[e.jsx("option",{value:"__all__",children:"Tous"}),u[r.key]?.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))]})]},r.key))})]})}function Q({type:a,selectedId:i,onSelect:l,onAddNew:u}){const n=I(a),t=n.list,r=p(s=>s[n.key]),m=p(s=>s.isModified),h=p(s=>s.isHomebrew),g=p(s=>s.activeDatasetId),[v,b]=d.useState("__all__"),[y,c]=d.useState({}),j=d.useMemo(()=>{if(!t?.primaryFilter)return[];const s=new Set(r.map(o=>t.primaryFilter.getValue(o)).filter(Boolean));return Array.from(s).map(o=>({value:String(o),label:String(o)}))},[r,t]),w=d.useMemo(()=>{const s={};if(!t?.advancedFilters)return s;for(const o of t.advancedFilters)if(o.type==="select"){const x=new Set(r.map(f=>o.getValue(f)).filter(f=>f!=null));s[o.key]=Array.from(x).map(f=>({value:String(f),label:String(f)}))}return s},[r,t]),k=d.useMemo(()=>t?r.filter(s=>{if(t.primaryFilter&&v!=="__all__"){const o=t.primaryFilter.getValue(s);if(String(o)!==v)return!1}for(const o of t.advancedFilters??[]){const x=y[o.key];if(x===void 0||x==="__all__"||x===!1)continue;const f=o.getValue(s);if(o.type==="boolean"){if(x&&!f)return!1}else if(String(f)!==String(x))return!1}return!0}):r,[r,v,y,t]),F=d.useCallback(s=>t?.search.fields?t.search.fields.map(o=>o.getValue(s)).filter(Boolean).join(" "):s.label,[t]),M=d.useCallback(s=>t?.display.fields?t.display.fields.map(o=>o.getValue(s)).filter(Boolean).join(" • "):"",[t]),_=d.useCallback(s=>h(a,s.label),[a,h]),E=d.useCallback(s=>m(a,s.label),[a,m]);return t?e.jsxs("div",{className:"flex flex-col h-full gap-3",children:[g&&u&&e.jsx("div",{className:"flex justify-end flex-shrink-0",children:e.jsxs(N,{variant:"outline",size:"sm",onClick:u,children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Ajouter"]})}),(t.primaryFilter||t.advancedFilters)&&e.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[t.primaryFilter&&e.jsx(H,{config:t.primaryFilter,value:v,onChange:b,options:j}),t.advancedFilters&&e.jsx(K,{filters:t.advancedFilters,values:y,onChange:(s,o)=>c(x=>({...x,[s]:o})),options:w})]}),e.jsx($,{entities:k,selectedId:i,onSelect:l,searchPlaceholder:t.search.placeholder,getSearchText:F,getReference:M,isHomebrew:_,isModified:E})]}):e.jsx("div",{className:"flex items-center justify-center h-full p-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["No list view available for ",a]})})}function q(a){const[i,l]=d.useState(()=>typeof window<"u"?window.matchMedia(a).matches:!1);return d.useEffect(()=>{const u=window.matchMedia(a),n=t=>l(t.matches);return u.addEventListener("change",n),()=>u.removeEventListener("change",n)},[a]),i}function U(){return q("(max-width: 1024px)")}function W({children:a,selectedEntity:i,emptyDetailMessage:l="Selectionnez un element pour voir les details",detailProps:u,header:n,customDetail:t}){const[r,m]=d.useState(!1),h=U(),g=t??(i?e.jsx(A,{entity:i,...u}):null);return e.jsxs("div",{className:"h-full flex flex-col gap-4",children:[n&&e.jsx("div",{className:"flex-shrink-0",children:n}),e.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-5 gap-4",children:[e.jsx("div",{className:"lg:col-span-2 overflow-hidden flex flex-col",children:a}),!h&&e.jsx("div",{className:"lg:col-span-3 overflow-hidden rounded-lg border bg-card text-card-foreground shadow-sm flex flex-col",children:g?e.jsx("div",{className:"flex-1 overflow-auto p-4",children:g}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground p-4",children:l})})]}),h&&i&&e.jsx(N,{variant:"default",size:"icon",className:"fixed bottom-20 right-4 z-50 rounded-full shadow-lg",onClick:()=>m(!0),children:e.jsx(B,{className:"h-5 w-5"})}),e.jsx(P,{open:h&&r,onOpenChange:m,entity:i,...u})]})}function X({activeCategory:a,onCategoryChange:i}){return e.jsx("div",{className:"flex gap-2",children:S.map(l=>e.jsx("button",{onClick:()=>i(l.id),className:`
            px-4 py-2 rounded-lg text-sm font-medium transition-colors
            ${a===l.id?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}
          `,children:l.label},l.id))})}function Y({entities:a,activeType:i,onTypeChange:l}){const u=p();return e.jsx("div",{className:"flex gap-2 flex-wrap",children:a.map(n=>{const t=u[n.arrayKey]?.length??0;return e.jsxs("button",{onClick:()=>l(n.id),className:`
              px-3 py-1.5 rounded-md text-sm transition-colors flex items-center gap-2
              ${i===n.id?"bg-secondary text-secondary-foreground font-medium":"bg-muted/50 hover:bg-muted text-muted-foreground"}
            `,children:[d.createElement(n.icon,{className:"w-3.5 h-3.5"}),n.label,t>0&&e.jsxs("span",{className:"text-xs opacity-70",children:["(",t,")"]})]},n.id)})})}function Z(){const a=new Map;for(const i of S)a.set(i.id,[]);for(const[i,l]of Object.entries(L)){const u=l.ui.compendiumCategory,n=a.get(u);n&&n.push({id:i,label:l.ui.labels.plural,icon:l.ui.icon,arrayKey:l.key})}return a}function se(){const[a,i]=d.useState("personnage"),[l,u]=d.useState("specie"),[n,t]=d.useState(null),r=p(c=>c.datasets),m=p(c=>c.activeDatasetId),h=p(c=>c.setActiveDataset),g=d.useMemo(()=>Z(),[]),v=g.get(a)||[],b=c=>{i(c);const j=g.get(c);j&&j.length>0&&u(j[0].id),t(null)},y=c=>{u(c),t(null)};return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx("div",{className:"border-b bg-background",children:e.jsxs("div",{className:"container mx-auto px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary",children:"Compendium"}),e.jsxs(O,{value:m??"official",onValueChange:c=>h(c==="official"?null:c),children:[e.jsx(z,{className:"w-48",children:e.jsx(R,{placeholder:"Source"})}),e.jsxs(G,{children:[e.jsx(C,{value:"official",children:"Officiel"}),r.map(c=>e.jsx(C,{value:c.metadata.id,children:c.metadata.name},c.metadata.id))]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx(X,{activeCategory:a,onCategoryChange:b})}),e.jsx(Y,{entities:v,activeType:l,onTypeChange:y})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-8 py-6 h-full",children:e.jsx(W,{selectedEntity:n,emptyDetailMessage:"Selectionnez un element pour voir les details",children:e.jsx(Q,{type:l,selectedId:n?.index,onSelect:t},l)})})})]})}export{se as default};
