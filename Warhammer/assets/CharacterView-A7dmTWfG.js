import{e as A,u as F,f as m,r as l,j as e,B as n,P as O,F as q,T as I,g as p,S as U,C as x,d as h}from"./index-BE7IJKJC.js";import{u as y}from"./characterStore-DoxbxCBK.js";import{e as J}from"./exportCharacter-bzZC3HJI.js";import{d as _}from"./exportToPdf-nxgwF2Ft.js";import{e as V,a as X,b as Z}from"./spellUtils-DntvT4X5.js";import{u as G}from"./useCharacterName-BWBPeT6c.js";import{C as H,A as K}from"./CharacterNotFound-9-2zyL5s.js";import{T as Q,a as W,b as u,c as j}from"./tabs-BFQAKUJE.js";import{e as Y}from"./constants--7Vy3u4O.js";import{I as ee,C as se,S as ae,X as te,a as le,B as re,b as ne,T as ce,E as ie,c as oe}from"./SpellsSection-D2gPtyah.js";import{D as me}from"./download-CXJOmQdJ.js";import"./createCharacter-Bh61okBK.js";import"./PDFButton-D0PW8ms3.js";import"./testId-C2BDkHTB.js";import"./calculators-SnRFNRCc.js";import"./coins-xZgmBx6z.js";function de(c,r){const d=new Blob([c],{type:"application/json"}),i=URL.createObjectURL(d),t=document.createElement("a");t.href=i,t.download=`${r}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(i)}function Ee(){const{id:c}=A(),r=F(),d=y(a=>a.characters),i=y(a=>a.deleteCharacter),t=m(a=>a.getSkillByLabel),f=m(a=>a.getTalentByLabel),g=m(a=>a.trappingMap),N=m(a=>a.spellMap),[E,v]=l.useState(!1),[S,C]=l.useState(!1),s=d.find(a=>a.saveName===c),o=G(s),b=l.useMemo(()=>s?Y(s.skills,t,s.characteristics):[],[s,t]),w=l.useMemo(()=>s?V(s.talents,f,s.characteristics):[],[s,f]),k=l.useMemo(()=>s?X(s.trappings,a=>g.get(a)):[],[s,g]),T=l.useMemo(()=>s?Z(s.spells,a=>N.get(a)):[],[s,N]);if(!s)return e.jsx(H,{});const L=()=>{const a=J(s),$=`${o.replace(/[^a-zA-Z0-9]/g,"_")}_${s.saveName}`;de(a,$)},B=async()=>{C(!0);try{const a=`${o.replace(/[^a-zA-Z0-9]/g,"_")}`;await _(s,a)}catch(a){console.error("PDF export failed:",a)}finally{C(!1)}},P=async()=>{if(s.saveName&&confirm(`Supprimer ${o} ? Cette action est irreversible.`)){v(!0);try{await i(s.saveName),r("/characters")}catch{v(!1)}}},D=()=>{r(`/character/${c}/edit`)},M=b.filter(a=>a.totalAdvances>0).length,z=w.filter(a=>a.total>0).length,R=T.length>0;return e.jsxs("div",{className:"container mx-auto p-4 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:o}),e.jsxs("p",{className:"text-muted-foreground",children:[s.specie?.data.label," â€¢ ",s.careerLevel?.career," (Niveau ",s.careerLevel?.level||1,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{onClick:()=>r("/characters"),variant:"outline",size:"sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsxs(n,{onClick:D,variant:"outline",size:"sm",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Editer"]}),e.jsxs(n,{onClick:L,variant:"outline",size:"sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"JSON"]}),e.jsxs(n,{onClick:B,variant:"outline",size:"sm",disabled:S,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),S?"Export...":"PDF"]}),e.jsxs(n,{onClick:P,variant:"destructive",size:"sm",disabled:E,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Supprimer"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 max-w-4xl mx-auto",children:[e.jsx(ee,{character:s}),e.jsx(se,{character:s}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(ae,{character:s}),e.jsx(te,{character:s})]}),e.jsxs(Q,{defaultValue:"skills",children:[e.jsxs(W,{className:"grid w-full grid-cols-3",children:[e.jsxs(u,{value:"skills",className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Competences"}),e.jsx(p,{variant:"secondary",className:"ml-1 text-xs px-1.5",children:M})]}),e.jsxs(u,{value:"talents",className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Talents"}),e.jsx(p,{variant:"secondary",className:"ml-1 text-xs px-1.5",children:z})]}),e.jsxs(u,{value:"equipment",className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Equipement"}),e.jsx(p,{variant:"secondary",className:"ml-1 text-xs px-1.5",children:k.length})]})]}),e.jsx(j,{value:"skills",className:"mt-3",children:e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsx(ne,{skills:b})})})}),e.jsx(j,{value:"talents",className:"mt-3",children:e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsx(ce,{talents:w})})})}),e.jsx(j,{value:"equipment",className:"mt-3",children:e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsx(ie,{trappings:k,wallet:s.wallet})})})})]}),R&&e.jsx(oe,{spells:T})]})]})}export{Ee as default};
