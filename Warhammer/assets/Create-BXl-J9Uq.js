const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModeStepView-0PmaCgBE.js","assets/index-B6PmHrA9.js","assets/index-DyamziUO.css","assets/builderStore-B1TiBw1E.js","assets/constants--7Vy3u4O.js","assets/calculators-SnRFNRCc.js","assets/createCharacter-Bh61okBK.js","assets/PDFButton-cXuFwtr_.js","assets/checkbox-D-MWC59H.js","assets/dice-6-aMIQIm74.js","assets/SpecieStepView-ByDQXiJ7.js","assets/EntitySelectionStepView-DgmS0R1y.js","assets/EntityList-BKrUmLEs.js","assets/testId-C2BDkHTB.js","assets/StarStepView-DwMbHHSq.js","assets/CareerStepView-BWPqXsSr.js","assets/CharacteristicsStepView-Bk27UH7n.js","assets/BudgetDisplay-BrCYQ2gi.js","assets/AdjusterControls-Bf2JImmr.js","assets/SkillsStepView-1ixE60gJ.js","assets/TalentsStepView-EUkyhLNd.js","assets/ChoiceButtons-BiFAOlQc.js","assets/TrappingsStepView-BWpNg4FX.js","assets/coins-CfuKB0dK.js","assets/ExperienceStepView-qq1Qj4Db.js","assets/TalentsBuyer-BC6ec9cG.js","assets/DetailsStepView-PH7kc5vS.js","assets/SummaryStepView-Dtm3PPXX.js","assets/characterStore-CbFUcF02.js","assets/tabs-BrSveVOA.js","assets/spellUtils-DntvT4X5.js","assets/SpellsSection-CRwLMyLm.js","assets/circle-alert-BPYtTUm1.js","assets/GodStepView--0njS3cA.js","assets/MagicTraditionStepView-Bxh5e7_S.js","assets/SpellsStepView-DyYcAC11.js"])))=>i.map(i=>d[i]);
import{h as I,r as d,j as e,B as S,_,i as P,k as A,l as q,m as F,I as H,n as z,o as L,p as R,q as O,s as E,C as W,a as K,b as Q,d as J,D as Y,t as Z,v as ee,w as se,u as te,f as p,x as ne,y as ae,z as ie}from"./index-B6PmHrA9.js";import{a as V,A as re,u as b}from"./builderStore-B1TiBw1E.js";const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ce=I("circle-question-mark",le);const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],de=I("circle",oe),w=d.createContext(null);function Se(t){const a=d.useContext(w);if(a)for(const i of t)a.consumed.add(i)}function ue(t){const a=d.useContext(w);return a?t.filter(i=>!a.consumed.has(i.id)):t}function xe({children:t}){const a={consumed:new Set};return e.jsx(w.Provider,{value:a,children:t})}function me({actions:t}){const{execute:a}=V(),x=ue(t).filter(l=>l.role==="button");return x.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(l=>e.jsxs(S,{"data-testid":`action-${l.id}`,onClick:()=>a(l.id),variant:l.xpBonus?"default":"outline",children:[l.label,l.xpBonus!==void 0&&l.xpBonus>0&&e.jsxs("span",{className:"ml-2 text-xs opacity-70",children:["+",l.xpBonus," XP"]})]},l.id))})}const pe={mode:d.lazy(()=>_(()=>import("./ModeStepView-0PmaCgBE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),specie:d.lazy(()=>_(()=>import("./SpecieStepView-ByDQXiJ7.js"),__vite__mapDeps([10,1,2,11,3,4,5,6,7,12,13,9]))),star:d.lazy(()=>_(()=>import("./StarStepView-DwMbHHSq.js"),__vite__mapDeps([14,1,2,11,3,4,5,6,7,12,13,9]))),career:d.lazy(()=>_(()=>import("./CareerStepView-BWPqXsSr.js"),__vite__mapDeps([15,1,2,11,3,4,5,6,7,12,13,9]))),characteristics:d.lazy(()=>_(()=>import("./CharacteristicsStepView-Bk27UH7n.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,9,13,17,18]))),skills:d.lazy(()=>_(()=>import("./SkillsStepView-1ixE60gJ.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,13,17,18,9]))),talents:d.lazy(()=>_(()=>import("./TalentsStepView-EUkyhLNd.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,21,13,9]))),trappings:d.lazy(()=>_(()=>import("./TrappingsStepView-BWpNg4FX.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,21,13,9,23]))),experience:d.lazy(()=>_(()=>import("./ExperienceStepView-qq1Qj4Db.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,17,25,13,9]))),details:d.lazy(()=>_(()=>import("./DetailsStepView-PH7kc5vS.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,9]))),summary:d.lazy(()=>_(()=>import("./SummaryStepView-Dtm3PPXX.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,28,29,30,31,13,23,32]))),god:d.lazy(()=>_(()=>import("./GodStepView--0njS3cA.js"),__vite__mapDeps([33,1,2,11,3,4,5,6,7,12,13,9]))),magicTradition:d.lazy(()=>_(()=>import("./MagicTraditionStepView-Bxh5e7_S.js"),__vite__mapDeps([34,1,2,11,3,4,5,6,7,12,13,9]))),spells:d.lazy(()=>_(()=>import("./SpellsStepView-DyYcAC11.js"),__vite__mapDeps([35,1,2,11,3,4,5,6,7,12,13,9])))};function he(){return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4 h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."})]})})}function fe({step:t}){const a=pe[t.id];if(!a)throw new Error(`No renderer found for step "${t.id}"`);return e.jsxs("div",{className:"h-full flex flex-col","data-testid":`step-${t.id}`,children:[t.subphase&&e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsx("span",{className:"text-sm text-primary px-2 py-1 bg-primary/10 rounded",children:t.subphase})}),t.errors.length>0&&e.jsx("div",{className:"mb-4 p-4 bg-destructive/10 border border-destructive rounded flex-shrink-0",children:t.errors.map((i,x)=>e.jsx("p",{className:"text-destructive",children:i},x))}),e.jsxs(xe,{children:[e.jsx("div",{className:"flex-1 min-h-0 overflow-auto",children:e.jsx(d.Suspense,{fallback:e.jsx(he,{}),children:e.jsx(a,{step:t})})}),t.actions.length>0&&e.jsx("div",{className:"mt-6 flex-shrink-0",children:e.jsx(me,{actions:t.actions})})]})]})}const T=[{id:"identity",label:"Identité",steps:["mode","specie","star","career"]},{id:"attributes",label:"Attributs",steps:["characteristics","skills","talents"]},{id:"equipment",label:"Équipement",steps:["trappings","experience"]},{id:"finalization",label:"Finalisation",steps:["details","summary"]}];function ge({steps:t,currentStepId:a,onStepClick:i}){const x=T.find(l=>l.steps.includes(a))?.id;return e.jsx("nav",{className:"flex flex-col h-full",children:T.map(l=>{const j=t.filter(u=>l.steps.includes(u.id)),v=l.id===x,h=j.every(u=>u.status==="completed");return j.some(u=>u.status==="completed"),e.jsxs("div",{className:"mb-1",children:[e.jsxs("div",{className:P("px-3 py-1.5 text-xs font-semibold uppercase tracking-wider",v?"text-primary":"text-muted-foreground/70"),children:[h&&e.jsx(A,{className:"inline h-3 w-3 mr-1"}),l.label]}),e.jsx("div",{className:"space-y-0.5",children:j.map(u=>{const r=u.id===a,m=u.status==="completed"&&i,c=u.status==="completed";return e.jsxs("button",{onClick:()=>m&&i(u.id),disabled:!m,className:P("w-full flex items-center gap-2 px-3 py-2 text-sm transition-all rounded-r-lg border-l-2",r&&"bg-primary/20 border-l-primary text-primary font-medium",c&&!r&&"border-l-primary/50 text-muted-foreground hover:bg-muted/50 hover:text-foreground",!c&&!r&&"border-l-transparent text-muted-foreground/60",m&&"cursor-pointer",!m&&!r&&"cursor-default"),children:[e.jsx("span",{className:P("flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-xs",r&&"bg-primary text-primary-foreground",c&&!r&&"bg-primary/30 text-primary",!c&&!r&&"bg-muted text-muted-foreground"),children:c?e.jsx(A,{className:"h-3 w-3"}):r?e.jsx(q,{className:"h-3 w-3"}):e.jsx(de,{className:"h-3 w-3"})}),e.jsx("span",{className:"truncate",children:u.label})]},u.id)})})]},l.id)})})}const C="__CUSTOM__";function je({availableSpecs:t,value:a,onChange:i,placeholder:x="Choisir...",className:l="",label:j,compact:v=!1}){const h=t.split(",").map(o=>o.trim()).filter(o=>o.length>0),u=a&&!h.includes(a),[r,m]=d.useState(u?C:a),[c,f]=d.useState(u?a:"");d.useEffect(()=>{const o=a&&!h.includes(a);m(o?C:a),f(o?a:"")},[a,h]);const g=o=>{m(o),o===C?(f(""),i("")):(f(""),i(o))},y=o=>{f(o),i(o)};return e.jsxs("div",{className:`flex flex-col gap-2 ${l}`,children:[j&&e.jsx(F,{className:v?"text-xs":"text-sm",children:j}),r===C?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{type:"text",placeholder:"Saisir une spécialisation...",value:c,onChange:o=>y(o.target.value),className:v?"h-7 text-xs flex-1":"flex-1",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>g(""),className:"text-xs text-muted-foreground hover:text-foreground underline whitespace-nowrap",children:"Annuler"})]}):e.jsxs(z,{value:r,onValueChange:g,children:[e.jsx(L,{className:v?"h-7 text-xs":"",children:e.jsx(R,{placeholder:x})}),e.jsxs(O,{children:[h.map(o=>e.jsx(E,{value:o,children:o},o)),e.jsx(E,{value:C,className:"italic",children:"Autre (saisie manuelle)..."})]})]})]})}function ve({entityType:t,markers:a,actions:i,getAvailableSpecs:x,pendingSpecs:l={},title:j}){const{execute:v}=V(),h=a.filter(r=>r.type==="spec"),u=(r,m)=>{r&&v(m.id,r)};return h.length===0?null:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:j??`Spécialisations (${h.length} restante${h.length>1?"s":""})`}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.map(r=>{const m=i.find(g=>g.id===re.resolve(t,"spec",r.id)),c=x(r.entity),f=l[r.id]??"";return e.jsxs(W,{children:[e.jsx(K,{className:"pb-2",children:e.jsx(Q,{className:"text-base",children:r.displayLabel})}),e.jsx(J,{children:e.jsx(je,{availableSpecs:c,value:f,onChange:g=>m&&u(g,m),placeholder:"Choisir une spécialisation...",compact:!0})})]},r.id)})})]})}function _e({step:t}){const a=t.data?.unresolvedMarkers??[],i=!!t.data?.skillDefinitions,x=!!t.data?.talentDefinitions,l=i?"skill":x?"talent":"skill",j=d.useMemo(()=>{const c=new Map;if(i){const f=t.data?.skillDefinitions??[];for(const g of f)c.set(g.label,g)}else if(x){const f=t.data?.talentDefinitions??[];for(const g of f)c.set(g.label,g)}return c},[t.data?.skillDefinitions,t.data?.talentDefinitions,i,x]),v=d.useCallback(c=>{if(c.specs&&c.specs.length>0)return c.specs.join(", ");const f=j.get(c.id);return f?f.specs??"":""},[j]),h=t.data?.pendingSpecs??{},r=a.filter(c=>c.type==="spec").length>0;if(!r)return null;const m=l==="skill"?"Choisir une spécialisation de compétence":"Choisir une spécialisation de talent";return e.jsx(Y,{open:r,children:e.jsxs(Z,{className:"sm:max-w-md",onPointerDownOutside:c=>c.preventDefault(),onEscapeKeyDown:c=>c.preventDefault(),children:[e.jsx(ee,{children:e.jsx(se,{children:m})}),e.jsx(ve,{entityType:l,markers:a,actions:t.actions,getAvailableSpecs:v,pendingSpecs:h})]})})}function be(){const t=te(),a=b(s=>s.builder),i=b(s=>s.currentStep),x=b(s=>s.steps),l=b(s=>s.goToStep),j=b(s=>s.lockCurrentStep),v=b(s=>s.clear),h=b(s=>s.save),u=b(s=>s.commitPending),r=b(s=>s.discardPending),m=b(s=>s.nextSubphase),c=b(s=>s.previousSubphase),f=b(s=>s.completeConditionalStep),g=p(s=>s.datasets),y=p(s=>s.activeDatasetId),o=p(s=>s.setActiveDataset);if(!a||!i)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:"Aucun personnage en cours de création"}),e.jsx("button",{onClick:()=>t("/characters/new"),className:"text-primary hover:underline",children:"Créer un nouveau personnage"})]})});const N=i.navigation,k=a.isOnConditionalStep(),n=N.canPrev,D=N.canNext,M=N.hasPending,B=()=>{if(!n)return;const s=i.id;N.hasPending&&r(s),c()},$=()=>{if(!D)return;const s=i.id;if(N.hasPending&&u(s),k){f();return}N.hasMoreSubphases||j(),m()},G=()=>{const s=i.id;r(s)},U=()=>{h(),v(),t("/characters")},X=s=>{l(s)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsxs("aside",{className:"w-56 flex-shrink-0 bg-muted flex flex-col",children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-sm font-semibold text-primary uppercase tracking-wide",children:"Création"}),e.jsxs(ne,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-sm cursor-help",children:[e.jsx(ce,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"XP:"}),e.jsx("span",{className:"font-bold text-primary text-lg",children:a.getTotalXp()})]})}),e.jsxs(ie,{side:"right",className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Points d'Expérience (XP)"}),e.jsx("p",{className:"text-xs",children:"Points gagnés lors de la création. Les choix aléatoires donnent plus d'XP. Utilisez-les pour améliorer votre personnage."})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto py-2 scrollbar-warhammer",children:e.jsx(ge,{steps:x,currentStepId:i.id,onStepClick:X})}),e.jsx("div",{className:"p-3",children:e.jsxs(z,{value:y??"official",onValueChange:s=>o(s==="official"?null:s),children:[e.jsx(L,{className:"w-full h-8 text-xs",children:e.jsx(R,{placeholder:"Source"})}),e.jsxs(O,{children:[e.jsx(E,{value:"official",children:"Officiel"}),g.map(s=>e.jsx(E,{value:s.metadata.id,children:s.metadata.name},s.metadata.id))]})]})})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("header",{className:"flex-shrink-0 px-6 py-3 bg-muted",children:e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:i.label}),i.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i.description})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:e.jsx(fe,{step:i})}),e.jsxs("footer",{className:"flex-shrink-0 px-4 py-3 flex justify-between items-center bg-muted",children:[e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsxs(S,{"data-testid":"nav-previous",variant:"outline",onClick:B,size:"sm",children:["← ",N.prevLabel||"Précédent"]}),e.jsx(S,{"data-testid":"nav-cancel",variant:"ghost",onClick:U,size:"sm",children:"Annuler"})]}),e.jsxs("div",{className:"flex gap-2",children:[M&&e.jsx(S,{"data-testid":"nav-reset",variant:"outline",onClick:G,size:"sm",children:"Réinitialiser"}),D&&e.jsxs(S,{"data-testid":"nav-next",onClick:$,size:"sm",className:"px-6",children:[N.nextLabel||"Suivant"," →"]})]})]})]})]}),e.jsx(_e,{step:i})]})}function Ne(){const t=b(n=>n.builder),a=b(n=>n.create),i=p(n=>n.specie),x=p(n=>n.star),l=p(n=>n.career),j=p(n=>n.careerLevel),v=p(n=>n.class),h=p(n=>n.characteristic),u=p(n=>n.skill),r=p(n=>n.talent),m=p(n=>n.spell),c=p(n=>n.trapping),f=p(n=>n.god),g=p(n=>n.magick),y=p(n=>n.eye),o=p(n=>n.hair),N=p(n=>n.detail),k=p(n=>n.names);return d.useEffect(()=>{if(!t&&i.length>0){const n={specie:i,star:x,career:l,careerLevel:j,class:v,characteristic:h,skill:u,talent:r,spell:m,trapping:c,god:f,magick:g,eye:y,hair:o,detail:N,names:k},D=window.__TEST_SEED__;a(n,void 0,D)}},[t,i,x,l,j,v,h,u,r,m,c,f,g,y,o,N,k,a]),i.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-muted-foreground",children:"Chargement des données..."})}):e.jsx(be,{})}const ke=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{ke as C,Se as u};
