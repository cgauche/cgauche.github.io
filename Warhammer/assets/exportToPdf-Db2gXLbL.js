import{P as I,a as x}from"./PDFButton-DossJXaQ.js";import{g as $,a as v,b as P}from"./spellUtils-DntvT4X5.js";import{n as C,r as h,t as M,d as D,u as F}from"./constants--7Vy3u4O.js";import{f as S}from"./index-DPNhxiUx.js";const B="/Warhammer/data/character-sheet.pdf",y=13,k=13,L=16,T={Art:{aug:"AugArt",total:"Art"},Athlétisme:{aug:"AugAthlétisme",total:"Athlétisme"},Calme:{aug:"AugCalme",total:"Calme"},Charme:{aug:"AugCharme",total:"Charme"},Chevaucher:{aug:"AugChevaucher",total:"Chevaucher"},Commandement:{aug:"AugCommandement",total:"Commandement"},"Conduite d'attelage":{aug:"AugConduite",total:"Conduite d'attelage"},"Corps à corps (base)":{aug:"AugCorpsACorpsBase",total:"Corps à corps (base)"},"Corps à corps":{aug:"AugCorpsACorps",total:"Corps à corps"},Discrétion:{aug:"AugDiscrétion",total:"Discrétion"},Divertissement:{aug:"AugDivertissement",total:"Divertissement"},"Emprise sur les animaux":{aug:"AugEmpriseAnimaux",total:"Emprise animaux"},Escalade:{aug:"AugEscalade",total:"Escalade"},Esquive:{aug:"AugEsquive",total:"Esquive"},Intimidation:{aug:"AugIntimidation",total:"Intimidation"},Intuition:{aug:"AugIntuition",total:"Intuition"},Marchandage:{aug:"AugMarchandage",total:"Marchandage"},Orientation:{aug:"AugOrientation",total:"Orientation"},Pari:{aug:"AugPari",total:"Pari"},Perception:{aug:"AugPerception",total:"Perception"},Ragot:{aug:"AugRagot",total:"Ragot"},Ramer:{aug:"AugRamer",total:"Ramer"},Résistance:{aug:"AugRésistance",total:"Résistance"},"Résistance à l'alcool":{aug:"AugRésistanceAlcool",total:"Résistance à l'alcool"},Subornation:{aug:"AugSubornation",total:"Subornation"},"Survie en extérieur":{aug:"AugSurvie",total:"Survie en extérieur"}},R={"Capacité de Combat":{init:"CCInitiale",aug:"CCAugmentation",total:"CC"},"Capacité de Tir":{init:"CTInitiale",aug:"CTAugmentation",total:"CT"},Force:{init:"FInitiale",aug:"FAugmentation",total:"F"},Endurance:{init:"EInitiale",aug:"EAugmentation",total:"E"},Initiative:{init:"IInitiale",aug:"IAugmentation",total:"I"},Agilité:{init:"AgInitiale",aug:"AgAugmentation",total:"Ag"},Dextérité:{init:"DexInitiale",aug:"DexAugmentation",total:"Dex"},Intelligence:{init:"IntInitiale",aug:"IntAugmentation",total:"Int"},"Force Mentale":{init:"FMInitiale",aug:"FMAugmentation",total:"FM"},Sociabilité:{init:"SocInitiale",aug:"SocAugmentation",total:"Soc"}};function i(t,n,l){if(l!=null)try{t.getTextField(n).setText(String(l))}catch{}}function f(t,n){return t.details.find(c=>c.type===n)?.value}function A(t,n){return t.characteristics.find(l=>l.id===n)}function N(t,n){i(t,"Nom",f(n,"Nom")),i(t,"Race",n.specie?.data.label),i(t,"Classe",n.careerLevel?.class),i(t,"Carrière",n.careerLevel?.career),i(t,"Niveau de Carrière",n.careerLevel?.data.label),i(t,"Schéma de Carrière",n.careerLevel?.career),i(t,"Statut",n.careerLevel?.status),i(t,"Âge",f(n,"Âge")),i(t,"Taille",f(n,"Taille")),i(t,"Cheveux",f(n,"Cheveux")),i(t,"Yeux",f(n,"Yeux")),i(t,"Signe distinctif",f(n,"Signe distinctif")),i(t,"AmbitionsCourt",f(n,"Ambition court terme")),i(t,"AmbitionsLong",f(n,"Ambition long terme"))}function O(t,n){for(const[c,a]of Object.entries(R)){const e=A(n,c);if(!e)continue;const o=C(e),s=e.advance;i(t,a.init,e.base),i(t,a.aug,s||""),i(t,a.total,o)}const l=A(n,"Mouvement");if(l){const c=C(l);i(t,"Mouvement",c),i(t,"Marche",c*2),i(t,"Course",c*4)}}function _(t,n){const l=A(n,"Destin"),c=A(n,"Chance"),a=A(n,"Résilience"),e=A(n,"Détermination");i(t,"Destin",l?C(l):void 0),i(t,"Chance",c?C(c):void 0),i(t,"Résilience",a?C(a):void 0),i(t,"Détermination",e?C(e):void 0),i(t,"Motivation",f(n,"Motivation"))}function q(t,n){i(t,"XPActuelle",n.xp.available),i(t,"XPDépensée",n.xp.totalUsed),i(t,"XPTotale",n.xp.max)}function X(t,n){const{skillMap:l}=S.getState();for(const[c,a]of Object.entries(T)){const e=c.endsWith("(base)"),o=e?c.replace(" (base)",""):c,s=l.get(o);if(!s)continue;const r=n.skills.find(p=>p.id!==o?!1:e?p.spec==="Base"||p.spec==="":!p.spec||p.spec===""),d=r?h(r):0;d>0&&i(t,a.aug,d);const g=n.characteristics.find(p=>p.id===s.characteristic);if(g){const m=C(g)+d;i(t,a.total,m)}}}function j(t,n){const{skillMap:l,characteristic:c}=S.getState();n.skills.filter(e=>{const o=!e.spec||e.spec===""||e.spec==="Base",s=!!T[e.id]||!!T[`${e.id} (base)`];return!!(!o||o&&!s)}).slice(0,y).forEach((e,o)=>{const s=o+1,r=M(e),d=h(e);i(t,`SkillName${s}`,r),i(t,`SkillAug${s}`,d||"");const g=l.get(e.id);if(g){const p=n.characteristics.find(m=>m.id===g.characteristic);if(p){const m=C(p),E=m+d;i(t,`SkillTotal${s}`,E);const u=c.find(b=>b.label===g.characteristic);i(t,`SkillChar${s}`,u?.abr||g.characteristic),i(t,`SkillVal${s}`,m)}}})}function U(t,n){n.talents.slice(0,k).forEach((l,c)=>{const a=c+1,e=l.spec?`${l.id} (${l.spec})`:l.id;i(t,`TalentName${a}`,e),i(t,`TalentCount${a}`,$(l))})}function W(t,n){const l=e=>S.getState().trappingMap.get(e);v(n.trappings,l).filter(e=>e.melee||e.ranged).slice(0,7).forEach((e,o)=>{const s=o+1;i(t,`NomArme${s}`,e.label),i(t,`EncArme${s}`,e.enc),e.melee?(i(t,`GroupeArme${s}`,"Mêlée"),i(t,`PortéeAllongeArme${s}`,e.melee.reach),i(t,`DégâtsArme${s}`,e.melee.damage),i(t,`AtoutsDéfautsArme${s}`,e.melee.qualities)):e.ranged&&(i(t,`GroupeArme${s}`,"Distance"),i(t,`PortéeAllongeArme${s}`,String(e.ranged.reach)),i(t,`DégâtsArme${s}`,e.ranged.damage),i(t,`AtoutsDéfautsArme${s}`,e.ranged.qualities))})}function J(t,n){const l=o=>S.getState().trappingMap.get(o),a=v(n.trappings,l).filter(o=>o.armor);a.slice(0,5).forEach((o,s)=>{const r=s+1;i(t,`NomArmure${r}`,o.label),i(t,`LocalisationArmure${r}`,o.armor?.loc),i(t,`EncArmure${r}`,o.enc),i(t,`PAArmure${r}`,o.armor?.pa),i(t,`AtoutsDéfautsArmure${r}`,o.armor?.qualities)});const e={Tête:0,"Bras droit":0,"Bras gauche":0,Corps:0,"Jambe droite":0,"Jambe gauche":0};for(const o of a){if(!o.armor?.loc)continue;const s=o.armor.pa||0,r=o.armor.loc.split(/[,;]/);for(const d of r){const g=d.trim();g in e?e[g]+=s:g==="Bras"?(e["Bras droit"]+=s,e["Bras gauche"]+=s):g==="Jambes"&&(e["Jambe droite"]+=s,e["Jambe gauche"]+=s)}}for(const[o,s]of Object.entries(e))s>0&&i(t,o,s)}function w(t,n){const l=e=>S.getState().trappingMap.get(e);v(n.trappings,l).filter(e=>!e.melee&&!e.ranged&&!e.armor).slice(0,L).forEach((e,o)=>{const s=o+1,r=e.quantity>1?` (×${e.quantity})`:"",d=`${e.label}${r}`;i(t,`PossName${s}`,d),i(t,`PossEnc${s}`,e.enc||"")})}function z(t,n){const l=n.details.find(e=>e.type==="CO"||e.type==="Or"),c=n.details.find(e=>e.type==="Argent"||e.type==="sc"),a=n.details.find(e=>e.type==="Sous"||e.type==="pa"||e.type==="Bronze");if(l&&i(t,"CO",l.value),c&&i(t,"sc",c.value),a&&i(t,"pa",a.value),!l&&!c&&!a){const e=r=>S.getState().trappingMap.get(r),s=v(n.trappings,e).find(r=>r.label==="Bourse"||r.type==="Argent");s?.price&&(i(t,"CO",s.price.gold),i(t,"sc",s.price.silver),i(t,"pa",s.price.bronze))}}function G(t,n){const l=A(n,"Force"),c=A(n,"Endurance"),a=A(n,"Force Mentale"),e=l?D(l):0,o=c?D(c):0,s=a?D(a):0;i(t,"BF",e),i(t,"BEx2",o*2),i(t,"BFM",s);const r=n.talents.find(p=>p.id===F.HARDY),d=r?$(r):0;i(t,"Dur à cuire",d||"");const g=e+o*2+s+d;i(t,"Blessures",g)}function H(t,n){const l=a=>S.getState().spellMap.get(a);P(n.spells,l).slice(0,8).forEach((a,e)=>{const o=e+1;i(t,`Sort/Prières${o}`,a.label),i(t,`NI${o}`,a.cn),i(t,`Portée${o}`,a.range),i(t,`Cible${o}`,a.target),i(t,`Durée${o}`,a.duration),i(t,`Effets${o}`,a.desc)})}function Y(t,n){const l=u=>S.getState().trappingMap.get(u),c=v(n.trappings,l),a=c.filter(u=>u.melee||u.ranged),e=c.filter(u=>u.armor),o=c.filter(u=>!u.melee&&!u.ranged&&!u.armor),s=a.reduce((u,b)=>u+b.totalEnc,0),r=e.reduce((u,b)=>u+b.totalEnc,0),d=o.reduce((u,b)=>u+b.totalEnc,0);i(t,"EncArmes",s),i(t,"EncArmures",r),i(t,"EncPossessions",d),i(t,"EncTotal",s+r+d);const g=A(n,"Force"),p=A(n,"Endurance"),m=g?D(g):0,E=p?D(p):0;i(t,"Enc Max",m+E)}async function K(t){const n=await fetch(B);if(!n.ok)throw new Error(`Failed to load PDF template: ${n.statusText}`);const l=await n.arrayBuffer(),c=await I.load(l),a=c.getForm();return N(a,t),O(a,t),_(a,t),q(a,t),X(a,t),j(a,t),U(a,t),W(a,t),J(a,t),w(a,t),z(a,t),G(a,t),H(a,t),Y(a,t),a.acroForm.dict.set(x.of("NeedAppearances"),c.context.obj(!0)),c.save({updateFieldAppearances:!1})}async function et(t,n){const l=await K(t),c=new Blob([new Uint8Array(l)],{type:"application/pdf"}),a=URL.createObjectURL(c),e=n||f(t,"Nom")||"personnage",o=document.createElement("a");o.href=a,o.download=`${e}.pdf`,o.click(),URL.revokeObjectURL(a)}export{et as d,K as e};
