import{j as e,B as N,g as x,f as b,Z as S,x as D,y as I,z as G,ab as O}from"./index-BE7IJKJC.js";import{a as z,A as j}from"./builderStore-C-8nvYTR.js";import{G as M,C as P}from"./ChoiceButtons-BpvLnoM4.js";import{D as T}from"./dice-6-QrvFEPoj.js";import"./constants--7Vy3u4O.js";import"./calculators-SnRFNRCc.js";import"./createCharacter-Bh61okBK.js";import"./PDFButton-D0PW8ms3.js";import"./testId-C2BDkHTB.js";function f({talentLabel:l,children:t}){const n=b(i=>i.getTalentByLabel)(l);return n?.desc?e.jsxs(D,{children:[e.jsx(I,{asChild:!0,children:t}),e.jsx(G,{side:"top",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{html:n.desc,className:"text-sm"}),n.max&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Max: ",n.max]}),n.test&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Test: ",n.test]})]})})]}):e.jsx(e.Fragment,{children:t})}function W({talentLabel:l,spec:t}){const i=!!b(d=>d.getTalentByLabel)(l)?.desc;return e.jsxs("span",{className:"font-medium inline-flex items-center gap-1",children:[l,t&&t!=="Au choix"&&e.jsxs("span",{className:"text-muted-foreground",children:[" (",t,")"]}),i&&e.jsx(f,{talentLabel:l,children:e.jsx(S,{className:"h-3.5 w-3.5 text-muted-foreground cursor-help"})})]})}function Q({step:l}){const{execute:t}=z(),h=l.data,{groupedTalents:n,pendingChoices:i,pendingRandomSelections:d,pendingSpecs:C,unresolvedMarkers:g}=h,R=(s,o)=>{t(j.resolve("talent","choice",s),o)},B=s=>{t(j.roll("talent",s))},k=()=>{t(j.random("talents"))},u=Array.isArray(g)?g.length:0,w=l.actions.find(s=>s.role==="roll"),A=Object.keys(i).length>0||Object.keys(d).length>0||Object.keys(C??{}).length>0,L=s=>{const o=String(s._index),y=s.choices&&s.choices.length>0,v=s.randomCount!==void 0&&s.randomCount>0,m=d[o],p=m&&m.length>0;if(!y&&!v&&!p)return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{talentLabel:s.id,spec:s.spec}),s.advance>1&&e.jsxs(x,{variant:"outline",children:["x",s.advance]})]});if(y){const r=s.origins[0]?.split(":")[0]??"unknown";return e.jsx(P,{testIdPrefix:`talent-choice-${r}`,options:s.choices.map(a=>a.label),selected:i[o],onSelect:a=>R(o,a),renderWrapper:(a,c)=>e.jsx(f,{talentLabel:a,children:c})})}if(v||p){const r=p,a=s.randomCount||m?.length||0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium",children:[a," talent",a>1?"s":""," aleatoire",a>1?"s":""]}),r?m.map(c=>e.jsx(f,{talentLabel:c,children:e.jsx(x,{variant:"default",className:"cursor-help",children:c})},c)):e.jsx(x,{variant:"outline",children:"a lancer"})]}),e.jsxs(N,{"data-testid":`talent-roll-${o}`,"data-needs-roll":!r,variant:"outline",size:"sm",onClick:()=>B(o),children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),r?"Relancer":"Lancer"]})]})}return null};return e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[u>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:w&&e.jsxs(N,{"data-testid":"talents-roll-all",variant:"outline",size:"sm",onClick:k,children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),A?"Relancer tout":"Générer tout"]})}),e.jsxs(x,{variant:"secondary",children:[u," choix restant",u>1?"s":""]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(M,{groups:n.map(s=>({key:s.key,label:s.label,items:s.talents})),renderItem:L,emptyMessage:"Aucun talent"})})]})}export{Q as default};
