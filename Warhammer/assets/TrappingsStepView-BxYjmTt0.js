import{j as e,g as l,B as u}from"./index-DPNhxiUx.js";import{a as A,A as d}from"./builderStore-eK4imx-H.js";import{G as B,C as R}from"./ChoiceButtons-Bd6FIGe-.js";import{D as x}from"./dice-6-khfjXeaw.js";import{C as M}from"./coins-BbqHfTwk.js";import"./constants--7Vy3u4O.js";import"./calculators-SnRFNRCc.js";import"./createCharacter-Bh61okBK.js";import"./PDFButton-DossJXaQ.js";import"./testId-C2BDkHTB.js";function S(n){const t=[];return n.gold>0&&t.push(`${n.gold} CO`),n.silver>0&&t.push(`${n.silver} PA`),n.bronze>0&&t.push(`${n.bronze} SB`),t.length>0?t.join(", "):"0 SB"}function L({step:n}){const{execute:t}=A(),h=n.data,{groupedTrappings:f,unresolvedMarkers:j,pendingChoices:m,wallet:o,diceInfo:i}=h,p=j.filter(s=>s.type==="choice"),g=(s,r)=>{t(d.resolve("trapping","choice",s),r)},v=()=>{t(d.roll("money","starting"))},y=()=>{t(d.random("trappings"))},a=p.length,N=Object.keys(m).length>0,C=!o&&i,b=a>0||C,k=s=>{const r=p.find(c=>c.id===s.id);return r&&r.options.length>0?e.jsx(R,{testIdPrefix:"trapping-choice",options:r.options,selected:m[s.id],onSelect:c=>g(s.id,c)}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:s.id}),s.quantity>1&&e.jsxs(l,{variant:"outline",children:["x",s.quantity]})]})};return e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Equipement"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&e.jsxs(l,{variant:"secondary",children:[a," choix restant",a>1?"s":""]}),b&&e.jsxs(u,{"data-testid":"trappings-roll-all",variant:"outline",size:"sm",onClick:y,children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),N||o?"Relancer tout":"Generer tout"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto space-y-4",children:[e.jsx(B,{groups:f.map(s=>({key:s.key,label:s.label,items:s.trappings})),renderItem:k,emptyMessage:"Aucun equipement"}),e.jsxs("div",{className:"rounded-lg border bg-card",children:[e.jsxs("div",{className:"p-3 font-semibold text-sm uppercase tracking-wide border-b flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Argent de depart"]}),e.jsx("div",{className:"p-3",children:o?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(l,{variant:"default",className:"text-primary font-bold",children:S(o)})}):i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i.tier," ",i.diceCount]}),e.jsxs(u,{"data-testid":"trapping-roll-money",variant:"outline",size:"sm",onClick:v,children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),i.isFixed?`${i.diceCount} CO`:`Lancer ${i.diceToRoll}d10`]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aucune carriere selectionnee"})})]})]})]})}export{L as default};
