import{h as F,f as s,r as x,j as e,I as w,B as n,Z as M,C as R,a as T,b as A,d as z,P as J,T as P,D as H,t as K,v as V,w as _,x as q,a3 as G,m as Z}from"./index-DPNhxiUx.js";import{T as $,a as Q,b as I,c as S}from"./tabs-CeVincgM.js";import{U as W}from"./upload-DUErLxq0.js";import{D as X}from"./download-DDzXpEpD.js";import{C as Y}from"./checkbox-gXCwxbfc.js";const ee=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ae=F("copy",ee);function te(){const o=s(a=>a.datasets),r=s(a=>a.activeDatasetId),h=s(a=>a.createDataset),l=s(a=>a.deleteDataset),j=s(a=>a.duplicateDataset),t=s(a=>a.renameDataset),E=s(a=>a.exportDataset),L=s(a=>a.importDataset),D=s(a=>a.setActiveDataset),[p,N]=x.useState(""),[g,d]=x.useState(null),[f,v]=x.useState(""),C=x.useRef(null),b=()=>{p.trim()&&(h(p.trim()),N(""))},B=a=>{const i=E(a);if(!i)return;const m=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),u=URL.createObjectURL(m),c=document.createElement("a");c.href=u,c.download=`${i.metadata.name}.json`,c.click(),URL.revokeObjectURL(u)},O=a=>{const i=a.target.files?.[0];if(!i)return;const m=new FileReader;m.onload=u=>{try{const c=JSON.parse(u.target?.result),k=L(c);k.success||alert("Erreur import: "+k.errors.join(", "))}catch{alert("Fichier JSON invalide")}},m.readAsText(i),a.target.value=""},y=()=>{g&&f.trim()&&(t(g,f.trim()),d(null),v(""))},U=(a,i)=>{d(a),v(i)};return e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsx("input",{type:"file",ref:C,onChange:O,accept:".json",className:"hidden"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:p,onChange:a=>N(a.target.value),placeholder:"Nom du nouveau dataset...",onKeyDown:a=>a.key==="Enter"&&b(),className:"flex-1"}),e.jsxs(n,{onClick:b,children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Créer"]}),e.jsxs(n,{variant:"outline",onClick:()=>C.current?.click(),children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Importer"]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(R,{className:r===null?"ring-2 ring-primary":"",children:[e.jsx(T,{className:"pb-2",children:e.jsxs(A,{className:"text-lg flex items-center justify-between",children:["Officiel",e.jsx(n,{variant:"outline",size:"sm",onClick:()=>D(null),disabled:r===null,children:r===null?"Actif":"Activer"})]})}),e.jsx(z,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Données officielles (lecture seule)"})})]}),o.map(a=>e.jsxs(R,{className:r===a.metadata.id?"ring-2 ring-primary":"",children:[e.jsx(T,{className:"pb-2",children:e.jsxs(A,{className:"text-lg flex items-center justify-between",children:[a.metadata.name,e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>D(a.metadata.id),disabled:r===a.metadata.id,children:r===a.metadata.id?"Actif":"Activer"}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>j(a.metadata.id),title:"Dupliquer",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>U(a.metadata.id,a.metadata.name),title:"Renommer",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>B(a.metadata.id),title:"Exporter",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>l(a.metadata.id),title:"Supprimer",children:e.jsx(P,{className:"h-4 w-4"})})]})]})}),e.jsx(z,{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Modifié le ",new Date(a.metadata.updatedAt).toLocaleDateString()]})})]},a.metadata.id))]}),e.jsx(H,{open:g!==null,onOpenChange:a=>!a&&d(null),children:e.jsxs(K,{children:[e.jsxs(V,{children:[e.jsx(_,{children:"Renommer le dataset"}),e.jsx(q,{className:"sr-only",children:"Entrez un nouveau nom pour le dataset"})]}),e.jsx(w,{value:f,onChange:a=>v(a.target.value),placeholder:"Nouveau nom...",onKeyDown:a=>a.key==="Enter"&&y()}),e.jsxs(G,{children:[e.jsx(n,{variant:"outline",onClick:()=>d(null),children:"Annuler"}),e.jsx(n,{onClick:y,children:"Renommer"})]})]})})]})}function se(){const o=s(t=>t.book),r=s(t=>t.getActiveDataset),h=s(t=>t.toggleBook),l=r(),j=l?.activeBooks??o.map(t=>t.abr);return l?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Cochez les livres à inclure dans le dataset "',l.metadata.name,'".']}),e.jsx("div",{className:"grid gap-2",children:o.map(t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{id:t.abr,checked:j.includes(t.abr),onCheckedChange:()=>h(t.abr)}),e.jsxs(Z,{htmlFor:t.abr,className:"cursor-pointer",children:[t.label," (",t.abr,")"]})]},t.abr))})]}):e.jsx("div",{className:"mt-4 text-muted-foreground",children:"Sélectionnez un dataset personnalisé pour gérer les livres actifs."})}function oe(){return e.jsxs("div",{className:"container mx-auto px-8 py-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary mb-6",children:"Mes données"}),e.jsxs($,{defaultValue:"datasets",children:[e.jsxs(Q,{children:[e.jsx(I,{value:"datasets",children:"Datasets"}),e.jsx(I,{value:"books",children:"Livres"})]}),e.jsx(S,{value:"datasets",children:e.jsx(te,{})}),e.jsx(S,{value:"books",children:e.jsx(se,{})})]})]})}export{oe as default};
