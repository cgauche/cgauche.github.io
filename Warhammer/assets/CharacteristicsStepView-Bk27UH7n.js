import{h as B,j as e,C as b,a as g,b as v,d as N,r as V,B as f,i as I}from"./index-B6PmHrA9.js";import{a as h,A as d}from"./builderStore-B1TiBw1E.js";import{D as y}from"./dice-6-aMIQIm74.js";import{t as w}from"./testId-C2BDkHTB.js";import{B as C}from"./BudgetDisplay-BrCYQ2gi.js";import{A as p}from"./AdjusterControls-Bf2JImmr.js";import"./constants--7Vy3u4O.js";import"./calculators-SnRFNRCc.js";import"./createCharacter-Bh61okBK.js";import"./PDFButton-cXuFwtr_.js";const z=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],S=B("arrow-left-right",z);function q({step:s}){const{execute:n}=h(),c=s.actions.find(l=>l.role==="roll"),r=s.actions.find(l=>l.role==="select");return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 h-full",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Comment déterminer vos caractéristiques ?"}),e.jsxs("div",{className:"flex gap-4",children:[c&&e.jsxs(b,{"data-testid":"char-method-roll",className:"cursor-pointer hover:border-primary transition-colors w-48",onClick:()=>n("roll"),children:[e.jsx(g,{className:"pb-2",children:e.jsxs(v,{className:"flex items-center gap-2 text-base",children:[e.jsx(y,{className:"h-5 w-5"}),"Jet de dés"]})}),e.jsx(N,{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["2d10 par caractéristique (+",c.xpBonus," XP)"]})})]}),r&&e.jsxs(b,{"data-testid":"char-method-pointbuy",className:"cursor-pointer hover:border-primary transition-colors w-48",onClick:()=>n("pointbuy"),children:[e.jsx(g,{className:"pb-2",children:e.jsxs(v,{className:"flex items-center gap-2 text-base",children:[e.jsx(S,{className:"h-5 w-5"}),"Répartition libre"]})}),e.jsx(N,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Répartissez 100 points"})})]})]})]})}function X({step:s}){const{execute:n}=h(),[c,r]=V.useState(null),l=s.data,o=l.pendingRoll,a=o?.options[0]??{},m=s.actions.find(t=>t.role==="button"),u=s.actions.find(t=>t.role==="reroll"),x=s.actions.find(t=>t.role==="cancel"),j=[...new Set(Object.values(a))].sort((t,i)=>i-t),D=t=>Object.entries(a).find(([,i])=>i===t)?.[0],P=t=>{r(i=>i===t?null:t)},A=t=>{if(c===null||!m)return;const i=D(c);if(!i||i===t){r(null);return}n("swap-rolls",i,t),r(null)},k=o?.xpBonus??0;return e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsxs("div",{className:"flex justify-center items-center gap-4 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Bonus XP: +",k]}),u&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>n("reroll"),children:"Relancer (0 XP)"}),x&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>n("switch-pointbuy"),children:"Répartition libre"})]}),e.jsxs("div",{className:"flex gap-6 justify-center",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-center text-muted-foreground",children:"Vos jets"}),e.jsx("div",{className:"flex flex-col gap-1",children:j.map(t=>{const i=c===t;return e.jsx("button",{onClick:()=>P(t),className:I("px-4 py-2 rounded-md text-lg font-bold transition-colors","border hover:border-primary",i?"bg-primary text-primary-foreground border-primary":"bg-card"),children:t},t)})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-center text-muted-foreground",children:c!==null?"Cliquez pour échanger":"Caractéristiques"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.characteristics.map(t=>{const i=a[t.label]??0,R=i===c;return e.jsxs(b,{className:I("cursor-pointer transition-colors w-32",c!==null&&"hover:border-primary",R&&"border-primary bg-primary/5"),onClick:()=>A(t.label),children:[e.jsx(g,{className:"pb-1 pt-2 px-3",children:e.jsx(v,{className:"text-xs",children:t.label})}),e.jsx(N,{className:"pb-2 px-3",children:e.jsx("div",{className:"text-xl font-bold",children:i})})]},t.label)})})]})]})]})}function E({step:s}){const{execute:n}=h(),c=s.data,{budget:r,currentDistribution:l,characteristics:o}=c,a=r.minPerItem,m=r.maxPerItem;return e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsx(C,{label:"Points",used:r.used,total:r.total,remaining:r.remaining}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:o.map(u=>{const x=l?.[u.label]??a,j=w("pointbuy",u.label);return e.jsxs("div",{className:"rounded-lg border bg-card p-2","data-testid":j,children:[e.jsx("div",{className:"text-xs text-center text-muted-foreground mb-1",children:u.label}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{value:x,onIncrement:()=>n(d.adjust("pointbuy","increment"),u.label),onDecrement:()=>n(d.adjust("pointbuy","decrement"),u.label),canIncrement:x<m&&r.remaining>0,canDecrement:x>a,testId:j})})]},u.label)})})]})}function M({step:s}){const{execute:n}=h(),c=s.data,{budget:r,advanceItems:l}=c,o=s.actions.find(a=>a.role==="roll");return e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsx(C,{label:"Avancees",used:r.used,total:r.total,remaining:r.remaining,action:o&&e.jsxs(f,{"data-testid":"advances-roll",variant:"outline",size:"sm",onClick:()=>n(d.random("advances")),children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),r.used>0?"Relancer":"Générer"]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:l.map(a=>{const m=w("advance",a.id);return e.jsxs("div",{className:"rounded-lg border bg-card p-2","data-testid":m,children:[e.jsx("div",{className:"text-xs text-center text-muted-foreground mb-1",children:a.id}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{value:a.value,valuePrefix:"+",onIncrement:()=>n(d.adjust("advance","increment"),a.id),onDecrement:()=>n(d.adjust("advance","decrement"),a.id),canIncrement:a.canIncrement,canDecrement:a.canDecrement,testId:m})})]},a.id)})})]})}function G({step:s}){const{execute:n}=h(),c=s.data,{budget:r,fate:l,resilience:o}=c,a=s.actions.find(m=>m.role==="roll");return e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsx(C,{label:"Points bonus",used:r.used,total:r.total,remaining:r.remaining,action:a&&e.jsxs(f,{"data-testid":"extra-roll",variant:"outline",size:"sm",onClick:()=>n(d.random("extra")),children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),r.used>0?"Relancer":"Générer"]})}),e.jsxs("div",{className:"flex justify-center gap-6",children:[e.jsxs("div",{className:"rounded-lg border bg-card p-4 w-40",children:[e.jsx("div",{className:"text-sm text-center text-muted-foreground mb-2",children:"Destin"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{value:l.base+l.current,onIncrement:()=>n(d.adjust("fate","increment")),onDecrement:()=>n(d.adjust("fate","decrement")),canIncrement:l.canIncrement,canDecrement:l.canDecrement,testId:"adjuster-destin"})}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground mt-1",children:["Base ",l.base," + ",l.current]})]}),e.jsxs("div",{className:"rounded-lg border bg-card p-4 w-40",children:[e.jsx("div",{className:"text-sm text-center text-muted-foreground mb-2",children:"Resilience"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{value:o.base+o.current,onIncrement:()=>n(d.adjust("resilience","increment")),onDecrement:()=>n(d.adjust("resilience","decrement")),canIncrement:o.canIncrement,canDecrement:o.canDecrement,testId:"adjuster-resilience"})}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground mt-1",children:["Base ",o.base," + ",o.current]})]})]})]})}function H(s){return s==="rolled-accepted"||s==="rolled-swapped"||s==="rerolled"}function Y({step:s}){const n=s.subphase,c=s.data.decision;return n==="base"?c==="pointbuy"?e.jsx(E,{step:s}):H(c)?e.jsx(X,{step:s}):e.jsx(q,{step:s}):n==="advances"?e.jsx(M,{step:s}):n==="extra"?e.jsx(G,{step:s}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("p",{className:"text-muted-foreground",children:["Phase inconnue: ",n]})})}export{Y as default};
